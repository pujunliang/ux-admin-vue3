import{bV as Y,bW as Q,d as C,bb as F,aM as k,bX as ee,ad as L,bY as j,bZ as N,A as Z,r as n,o as b,c as $,b as l,w as t,F as x,a as p,G as E,bx as A,aP as P,ar as H,h as M,bH as y,p as K,g as G,bo as le,u as ae,b_ as te,aK as oe,e as D,bu as se,bl as ie,f as de,bJ as ne}from"./index-56d49eb9.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";const O=c=>Y.post(Q+"/file/upload/img",c),R=c=>(K("data-v-546a27b0"),c=c(),G(),c),re={class:"upload-box"},ue=["src"],pe=R(()=>p("span",null,"编辑",-1)),ce=R(()=>p("span",null,"查看",-1)),me=R(()=>p("span",null,"删除",-1)),_e={key:1,class:"upload-empty"},fe={class:"el-upload__tip"},ve=C({name:"UploadImg"}),ge=C({...ve,props:{imageUrl:{default:""},api:{},drag:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},fileSize:{default:5},fileType:{default:()=>["image/jpeg","image/png","image/gif"]},height:{default:"150px"},width:{default:"150px"},borderRadius:{default:"8px"}},emits:["update:imageUrl"],setup(c,{emit:I}){const u=c;F(o=>({"228261d3":o.width,"13fadeba":o.height,"33b38f31":o.borderRadius}));const g=k("id-"+ee()),m=k(!1),a=L(j,void 0),_=L(N,void 0),w=Z(()=>u.disabled||(a==null?void 0:a.disabled)),T=async o=>{let r=new FormData;r.append("file",o.file);try{const e=u.api??O,{data:s}=await e(r);I("update:imageUrl",s.fileUrl),_!=null&&_.prop&&(a==null||a.validateField([_.prop]))}catch(e){o.onError(e)}},h=()=>{I("update:imageUrl","")},d=()=>{const o=document.querySelector(`#${g.value} .el-upload__input`);o&&o.dispatchEvent(new MouseEvent("click"))},z=o=>{const r=o.size/1024/1024<u.fileSize,e=u.fileType.includes(o.type);return e||y({title:"温馨提示",message:"上传图片不符合所需的格式！",type:"warning"}),r||setTimeout(()=>{y({title:"温馨提示",message:`上传图片大小不能超过 ${u.fileSize}M！`,type:"warning"})},0),e&&r},S=()=>{y({title:"温馨提示",message:"图片上传成功！",type:"success"})},v=()=>{y({title:"温馨提示",message:"图片上传失败，请您重新上传！",type:"error"})};return(o,r)=>{const e=n("Edit"),s=n("el-icon"),f=n("ZoomIn"),V=n("Delete"),q=n("Plus"),i=n("el-upload"),B=n("el-image-viewer");return b(),$("div",re,[l(i,{id:g.value,action:"#",class:H(["upload",w.value?"disabled":"",o.drag?"no-border":""]),multiple:!1,disabled:w.value,"show-file-list":!1,"http-request":T,"before-upload":z,"on-success":S,"on-error":v,drag:o.drag,accept:o.fileType.join(",")},{default:t(()=>[o.imageUrl?(b(),$(x,{key:0},[p("img",{src:o.imageUrl,class:"upload-image"},null,8,ue),p("div",{class:"upload-handle",onClick:r[1]||(r[1]=A(()=>{},["stop"]))},[w.value?E("",!0):(b(),$("div",{key:0,class:"handle-icon",onClick:d},[l(s,null,{default:t(()=>[l(e)]),_:1}),pe])),p("div",{class:"handle-icon",onClick:r[0]||(r[0]=U=>m.value=!0)},[l(s,null,{default:t(()=>[l(f)]),_:1}),ce]),w.value?E("",!0):(b(),$("div",{key:1,class:"handle-icon",onClick:h},[l(s,null,{default:t(()=>[l(V)]),_:1}),me]))])],64)):(b(),$("div",_e,[P(o.$slots,"empty",{},()=>[l(s,null,{default:t(()=>[l(q)]),_:1})],!0)]))]),_:3},8,["id","class","disabled","drag","accept"]),p("div",fe,[P(o.$slots,"tip",{},void 0,!0)]),m.value?(b(),M(B,{key:0,"url-list":[o.imageUrl],onClose:r[2]||(r[2]=U=>m.value=!1)},null,8,["url-list"])):E("",!0)])}}});const be=J(ge,[["__scopeId","data-v-546a27b0"]]),W=c=>(K("data-v-eacd824b"),c=c(),G(),c),we={class:"upload-box"},ye={class:"upload-empty"},he=["src"],Ve=["onClick"],Ue=W(()=>p("span",null,"查看",-1)),$e=["onClick"],ke=W(()=>p("span",null,"删除",-1)),Ie={class:"el-upload__tip"},Se=C({name:"UploadImgs"}),Ce=C({...Se,props:{fileList:{default:()=>[]},api:{},drag:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},limit:{default:5},fileSize:{default:5},fileType:{default:()=>["image/jpeg","image/png","image/gif"]},height:{default:"150px"},width:{default:"150px"},borderRadius:{default:"8px"}},emits:["update:fileList"],setup(c,{emit:I}){const u=c;F(e=>({"5eff180e":e.borderRadius,f6f463ea:e.width,"1b360cfc":e.height}));const g=L(j,void 0),m=L(N,void 0),a=Z(()=>u.disabled||(g==null?void 0:g.disabled)),_=k(u.fileList);le(()=>u.fileList,e=>{_.value=e});const w=e=>{const s=e.size/1024/1024<u.fileSize,f=u.fileType.includes(e.type);return f||y({title:"温馨提示",message:"上传图片不符合所需的格式！",type:"warning"}),s||setTimeout(()=>{y({title:"温馨提示",message:`上传图片大小不能超过 ${u.fileSize}M！`,type:"warning"})},0),f&&s},T=async e=>{let s=new FormData;s.append("file",e.file);try{const f=u.api??O,{data:V}=await f(s);e.onSuccess(V)}catch(f){e.onError(f)}},h=(e,s)=>{e&&(s.url=e.fileUrl,I("update:fileList",_.value),m!=null&&m.prop&&(g==null||g.validateField([m.prop])),y({title:"温馨提示",message:"图片上传成功！",type:"success"}))},d=e=>{_.value=_.value.filter(s=>s.url!==e.url||s.name!==e.name),I("update:fileList",_.value)},z=()=>{y({title:"温馨提示",message:"图片上传失败，请您重新上传！",type:"error"})},S=()=>{y({title:"温馨提示",message:`当前最多只能上传 ${u.limit} 张图片，请移除后上传！`,type:"warning"})},v=k(""),o=k(!1),r=e=>{v.value=e.url,o.value=!0};return(e,s)=>{const f=n("el-icon"),V=n("ZoomIn"),q=n("Delete"),i=n("el-upload"),B=n("el-image-viewer");return b(),$("div",we,[l(i,{"file-list":_.value,"onUpdate:fileList":s[1]||(s[1]=U=>_.value=U),action:"#","list-type":"picture-card",class:H(["upload",a.value?"disabled":"",e.drag?"no-border":""]),multiple:!0,disabled:a.value,limit:e.limit,"http-request":T,"before-upload":w,"on-exceed":S,"on-success":h,"on-error":z,drag:e.drag,accept:e.fileType.join(",")},{file:t(({file:U})=>[p("img",{src:U.url,class:"upload-image"},null,8,he),p("div",{class:"upload-handle",onClick:s[0]||(s[0]=A(()=>{},["stop"]))},[p("div",{class:"handle-icon",onClick:X=>r(U)},[l(f,null,{default:t(()=>[l(V)]),_:1}),Ue],8,Ve),a.value?E("",!0):(b(),$("div",{key:0,class:"handle-icon",onClick:X=>d(U)},[l(f,null,{default:t(()=>[l(q)]),_:1}),ke],8,$e))])]),default:t(()=>[p("div",ye,[P(e.$slots,"empty",{},()=>[l(f,null,{default:t(()=>[l(ae(te))]),_:1})],!0)])]),_:3},8,["file-list","class","disabled","limit","drag","accept"]),p("div",Ie,[P(e.$slots,"tip",{},void 0,!0)]),o.value?(b(),M(B,{key:0,"url-list":[v.value],onClose:s[2]||(s[2]=U=>o.value=!1)},null,8,["url-list"])):E("",!0)])}}});const Te=J(Ce,[["__scopeId","data-v-eacd824b"]]),ze=p("span",null,"请上传头像",-1),qe=p("span",null,"请上传照片",-1),Ee=C({name:"UserDrawer"}),Pe=C({...Ee,setup(c,{expose:I}){const u=[{label:"男",value:1},{label:"女",value:2}],g=oe({avatar:[{required:!0,message:"请上传用户头像"}],photo:[{required:!0,message:"请上传用户照片"}],username:[{required:!0,message:"请填写用户姓名"}],gender:[{required:!0,message:"请选择性别"}],idCard:[{required:!0,message:"请填写身份证号"}],email:[{required:!0,message:"请填写邮箱"}],address:[{required:!0,message:"请填写居住地址"}]}),m=k(!1),a=k({isView:!1,title:"",row:{}}),_=h=>{a.value=h,m.value=!0},w=k(),T=()=>{w.value.validate(async h=>{if(h)try{await a.value.api(a.value.row),ne.success({message:`${a.value.title}用户成功！`}),a.value.getTableList(),m.value=!1}catch{}})};return I({acceptParams:_}),(h,d)=>{const z=n("Avatar"),S=n("el-icon"),v=n("el-form-item"),o=n("Picture"),r=n("el-input"),e=n("el-option"),s=n("el-select"),f=n("el-form"),V=n("el-button"),q=n("el-drawer");return b(),M(q,{modelValue:m.value,"onUpdate:modelValue":d[8]||(d[8]=i=>m.value=i),"destroy-on-close":!0,size:"450px",title:`${a.value.title}用户`},{footer:t(()=>[l(V,{onClick:d[7]||(d[7]=i=>m.value=!1)},{default:t(()=>[D("取消")]),_:1}),se(l(V,{type:"primary",onClick:T},{default:t(()=>[D(" 确定 ")]),_:1},512),[[ie,!a.value.isView]])]),default:t(()=>[l(f,{ref_key:"ruleFormRef",ref:w,"label-width":"100px","label-suffix":" :",rules:g,disabled:a.value.isView,model:a.value.row,"hide-required-asterisk":a.value.isView},{default:t(()=>[l(v,{label:"用户头像",prop:"avatar"},{default:t(()=>[l(be,{"image-url":a.value.row.avatar,"onUpdate:imageUrl":d[0]||(d[0]=i=>a.value.row.avatar=i),width:"135px",height:"135px","file-size":3},{empty:t(()=>[l(S,null,{default:t(()=>[l(z)]),_:1}),ze]),tip:t(()=>[D("头像大小不能超过 3M")]),_:1},8,["image-url"])]),_:1}),l(v,{label:"用户照片",prop:"photo"},{default:t(()=>[l(Te,{"file-list":a.value.row.photo,"onUpdate:fileList":d[1]||(d[1]=i=>a.value.row.photo=i),height:"140px",width:"140px","border-radius":"50%"},{empty:t(()=>[l(S,null,{default:t(()=>[l(o)]),_:1}),qe]),tip:t(()=>[D("照片大小不能超过 5M")]),_:1},8,["file-list"])]),_:1}),l(v,{label:"用户姓名",prop:"username"},{default:t(()=>[l(r,{modelValue:a.value.row.username,"onUpdate:modelValue":d[2]||(d[2]=i=>a.value.row.username=i),placeholder:"请填写用户姓名",clearable:""},null,8,["modelValue"])]),_:1}),l(v,{label:"性别",prop:"gender"},{default:t(()=>[l(s,{modelValue:a.value.row.gender,"onUpdate:modelValue":d[3]||(d[3]=i=>a.value.row.gender=i),placeholder:"请选择性别",clearable:""},{default:t(()=>[(b(),$(x,null,de(u,i=>l(e,{key:i.value,label:i.label,value:i.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"身份证号",prop:"idCard"},{default:t(()=>[l(r,{modelValue:a.value.row.idCard,"onUpdate:modelValue":d[4]||(d[4]=i=>a.value.row.idCard=i),placeholder:"请填写身份证号",clearable:""},null,8,["modelValue"])]),_:1}),l(v,{label:"邮箱",prop:"email"},{default:t(()=>[l(r,{modelValue:a.value.row.email,"onUpdate:modelValue":d[5]||(d[5]=i=>a.value.row.email=i),placeholder:"请填写邮箱",clearable:""},null,8,["modelValue"])]),_:1}),l(v,{label:"居住地址",prop:"address"},{default:t(()=>[l(r,{modelValue:a.value.row.address,"onUpdate:modelValue":d[6]||(d[6]=i=>a.value.row.address=i),placeholder:"请填写居住地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","disabled","model","hide-required-asterisk"])]),_:1},8,["modelValue","title"])}}});export{Pe as _};
